{% extends "layout.html" %}
{% block title %}{{task.title}} - 任务信息{% endblock %}
{% block content %}
<div class="page-header">
  <h1>{{task.title}}</h1>
</div>

<div class="panel panel-default">
  <div class="panel-heading"><h2 class="panel-title">任务信息</h2></div>
  <div class="panel-body">
    <dl class="dl-horizontal">
      <dt>截止日期</dt>
      <dd>{{task.deadline | format_from_utc}}</dd>
      <dt>状态</dt>
      <dd>
      {% if task.status == 'configuring' %}
        <span class="label label-default">配置中</span>
      {% elif task.status == 'published' %}
        <span class="label label-warning">进行中</span>
      {% elif task.status == 'ended' %}
        <span class="label label-success">已截止</span>
      {% endif %}
      {% if task.involved %}
        <span class="label label-danger">与我有关</span>
      {% endif %}
      </dd>
    </dl>
    <form class="form-inline" method="post" action="{{ url_for('post_task_publish') }}" onsubmit="return confirm('确认？');">
      <fieldset>
        <input type="hidden" name="id" value="{{task.id}}">
        <button type="submit" {% if task.published %}disabled{% endif %} class="form-control btn-md btn-default">
          <i class="icon-filter icon-white"></i> 发布任务
        </button>
      </fieldset>
    </form>
    {% if task.involved %}
      <a class="btn btn-md btn-primary" href="{{ url_for('get_task_my_report', id=task.id) }}">
        <i class="icon-filter icon-white"></i> 查看我的小结
      </a>
    {% endif %}
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading"><h2 class="panel-title">用户列表</h2></div>
  <div class="panel-body">
    <a class="btn btn-primary" href="{{ url_for('get_user_list') }}">
      <i class="icon-filter icon-white"></i> 添加用户
    </a>
  </div>
  <table class="table table-striped table-bordered table-condensed table-helper table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>名字</th>
        <th>入学年份</th>
        <th>学号</th>
        <th>已转出</th>
        <th>允许登入</th>
      </tr>
    </thead>
    <tbody>
    {% for u in users %}
      <tr data-value="{{u.id}}">
        <td>{{u.id}}</td>
        <td>{{u.name}}</td>
        <td>{{u.category}}</td>
        <td>{{u.stuid}}</td>
        <td><input type="checkbox" {% if u.dropped %}checked{% endif %} disabled></td>
        <td><input type="checkbox" {% if u.allow_login %}checked{% endif %} disabled></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<div class="panel panel-default">
  <div class="panel-heading"><h2 class="panel-title">任务要求</h2></div>
  <div class="panel-body">
    <form class="form-inline" method="post" action="{{ url_for('post_task_add_requirement') }}">
      <fieldset>
        <input type="hidden" name="id" value="{{task.id}}">
        <div>
          <select name="type" class="input-md form-control">
            <option value="None" selected>任务类型</option>
            <option value="freetext">自由文本</option>
            <option value="course_review">课程评价</option>
            <option value="peer_review">同学评价</option>
            <option value="ta_review">助教评价</option>
          </select>
          <input type="text" name="title" size="24" class="input-md form-control" placeholder="标题" required>
          <input type="number" name="number" size="4" class="input-md form-control monospace" min="0" placeholder="最少数量" required>
          <input type="text" name="config" size="40" class="input-md form-control monospace" placeholder="config">
        </div>
        <div>
          <textarea name="description" rows="3" cols="80" class="form-control" placeholder="说明"></textarea>
        </div>
        <button type="submit" class="form-control btn-md btn-primary">
          <i class="icon-filter icon-white"></i> 添加任务要求
        </button>
      </fieldset>
    </form>
    <pre>about config:
format:
    key1: value1 | key2: value2 | ...
peer_review keys => values:
    type  => positive / negative / neutral</pre>
  </div>
  <table class="table table-striped table-bordered table-condensed table-helper table-hover">
    <thead>
      <tr>
        <th>编号</th>
        <th>标题</th>
        <th>类型</th>
        <th>至少</th>
        <th>设定</th>
        <th>说明</th>
      </tr>
    </thead>
    <tbody>
    {% for r in requirements %}
      <tr data-value="{{r.id}}">
        <td>{{r.order}}</td>
        <td>{{r.title}}</td>
        <td class="monospace">{{r.type.name}}</td>
        <td>{{r.number}}</td>
        <td>{% if r.config %}<code>{{r.config}}</code>{% endif %}</td>
        <td>{{r.description | nl2p | safe}}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}